<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEEP READER ‚Äî Master Complex Knowledge</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Space+Mono:wght@400;700&family=Syne:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #F5F0E8;
            --bg-secondary: #EDE6DA;
            --bg-tertiary: #E3DCD0;
            --text-primary: #1A1A1A;
            --text-secondary: #5A5A5A;
            --accent-coral: #FF6B4A;
            --accent-indigo: #4A4AFF;
            --accent-mint: #2DD4A8;
            --accent-amber: #FFB84A;
            --accent-plum: #9B4AFF;
            --accent-rose: #FF4A8D;
            --card-shadow: 4px 4px 0 #1A1A1A;
            --card-shadow-hover: 8px 8px 0 #1A1A1A;
            --card-shadow-large: 12px 12px 0 #1A1A1A;
            --border: 3px solid #1A1A1A;
            --border-thin: 2px solid #1A1A1A;
            --radius: 0;
            --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --bg-primary: #0F0F0F;
            --bg-secondary: #1A1A1A;
            --bg-tertiary: #252525;
            --text-primary: #F5F0E8;
            --text-secondary: #A5A5A5;
            --card-shadow: 4px 4px 0 #F5F0E8;
            --card-shadow-hover: 8px 8px 0 #F5F0E8;
            --card-shadow-large: 12px 12px 0 #F5F0E8;
            --border: 3px solid #F5F0E8;
            --border-thin: 2px solid #F5F0E8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Space Mono', monospace;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            transition: background var(--transition), color var(--transition);
        }

        /* Noise texture overlay */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            opacity: 0.03;
            pointer-events: none;
            z-index: 1000;
        }

        /* ===== UTILITY CLASSES ===== */
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== HEADER ===== */
        header {
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: var(--border);
            position: sticky;
            top: 0;
            background: var(--bg-primary);
            z-index: 100;
        }

        .logo {
            font-family: 'Syne', sans-serif;
            font-weight: 800;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            letter-spacing: -0.03em;
            line-height: 1;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--accent-coral);
            border: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .logo span {
            font-family: 'Instrument Serif', serif;
            font-weight: 400;
            font-style: italic;
            font-size: 0.5em;
            color: var(--text-secondary);
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .icon-btn {
            width: 44px;
            height: 44px;
            background: var(--bg-secondary);
            border: var(--border);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            transition: all var(--transition);
            box-shadow: var(--card-shadow);
        }

        .icon-btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: var(--card-shadow-hover);
        }

        /* ===== MAIN LAYOUT ===== */
        .app-container {
            display: flex;
            min-height: calc(100vh - 75px);
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 320px;
            border-right: var(--border);
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            transition: transform var(--transition);
        }

        .sidebar-section {
            padding: 1.5rem;
            border-bottom: var(--border);
        }

        .sidebar-title {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Learning Progress */
        .learning-stage {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .stage-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-primary);
            border: 2px solid transparent;
            cursor: pointer;
            transition: all var(--transition);
            position: relative;
        }

        .stage-item:hover {
            border-color: var(--text-secondary);
        }

        .stage-item.active {
            border-color: var(--accent-coral);
            background: var(--bg-tertiary);
        }

        .stage-item.completed {
            border-color: var(--accent-mint);
        }

        .stage-item.completed::after {
            content: '‚úì';
            position: absolute;
            right: 0.75rem;
            color: var(--accent-mint);
            font-weight: bold;
        }

        .stage-number {
            width: 28px;
            height: 28px;
            background: var(--text-primary);
            color: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Syne', sans-serif;
            font-weight: 800;
            font-size: 0.8rem;
        }

        .stage-item.completed .stage-number {
            background: var(--accent-mint);
            color: #1A1A1A;
        }

        .stage-item.active .stage-number {
            background: var(--accent-coral);
        }

        .stage-info h4 {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .stage-info p {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-top: 0.15rem;
        }

        /* Retention meter */
        .retention-meter {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--bg-primary);
            border: var(--border-thin);
        }

        .retention-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .retention-bar {
            height: 8px;
            background: var(--bg-tertiary);
            position: relative;
            overflow: hidden;
        }

        .retention-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-coral), var(--accent-amber), var(--accent-mint));
            width: 0%;
            transition: width 1s ease;
        }

        .retention-markers {
            display: flex;
            justify-content: space-between;
            margin-top: 0.25rem;
            font-size: 0.6rem;
            color: var(--text-secondary);
        }

        /* Concepts sidebar */
        .concepts-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .concept-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 0.75rem;
            background: var(--bg-primary);
            cursor: pointer;
            transition: all var(--transition);
            font-size: 0.8rem;
            border: 2px solid transparent;
        }

        .concept-item:hover {
            border-color: var(--text-secondary);
        }

        .concept-item.active {
            border-color: var(--accent-indigo);
            background: var(--bg-tertiary);
        }

        .concept-icon {
            width: 24px;
            height: 24px;
            background: var(--accent-indigo);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: #fff;
        }

        .concept-item[data-mastery="low"] .concept-icon { background: var(--accent-coral); }
        .concept-item[data-mastery="medium"] .concept-icon { background: var(--accent-amber); }
        .concept-item[data-mastery="high"] .concept-icon { background: var(--accent-mint); }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        /* ===== LANDING VIEW ===== */
        .landing-view {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            text-align: center;
        }

        .landing-hero {
            max-width: 700px;
        }

        .landing-hero h1 {
            font-family: 'Instrument Serif', serif;
            font-size: clamp(2.5rem, 6vw, 4rem);
            line-height: 1.1;
            margin-bottom: 1.5rem;
        }

        .landing-hero h1 em {
            font-style: italic;
            color: var(--accent-coral);
        }

        .landing-hero p {
            font-size: 1.1rem;
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 2.5rem;
        }

        .url-input-container {
            display: flex;
            gap: 0;
            max-width: 600px;
            width: 100%;
            margin: 0 auto;
        }

        .url-input {
            flex: 1;
            padding: 1.25rem 1.5rem;
            font-family: 'Space Mono', monospace;
            font-size: 1rem;
            background: var(--bg-secondary);
            border: var(--border);
            border-right: none;
            color: var(--text-primary);
            transition: all var(--transition);
        }

        .url-input::placeholder {
            color: var(--text-secondary);
        }

        .url-input:focus {
            outline: none;
            background: var(--bg-primary);
        }

        .analyze-btn {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            padding: 1.25rem 2rem;
            background: var(--accent-coral);
            color: #fff;
            border: var(--border);
            cursor: pointer;
            box-shadow: var(--card-shadow);
            transition: all var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
        }

        .analyze-btn:hover {
            transform: translate(-4px, -4px);
            box-shadow: var(--card-shadow-hover);
        }

        .analyze-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .landing-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 4rem;
            max-width: 800px;
            width: 100%;
        }

        .feature-card {
            padding: 1.5rem;
            background: var(--bg-secondary);
            border: var(--border);
            text-align: left;
        }

        .feature-card h3 {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feature-card p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* ===== READER VIEW ===== */
        .reader-view {
            flex: 1;
            display: none;
            flex-direction: column;
        }

        .reader-view.active {
            display: flex;
        }

        /* Article Header */
        .article-header {
            padding: 2rem;
            border-bottom: var(--border);
            background: var(--bg-secondary);
        }

        .article-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .meta-tag {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 0.4rem 0.8rem;
            background: var(--accent-indigo);
            color: #fff;
        }

        .article-title {
            font-family: 'Instrument Serif', serif;
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            line-height: 1.2;
            margin-bottom: 1rem;
        }

        .article-stats {
            display: flex;
            gap: 2rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .article-stats span {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        /* Content Area with Tabs */
        .content-tabs {
            display: flex;
            border-bottom: var(--border);
            background: var(--bg-secondary);
            overflow-x: auto;
        }

        .content-tab {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.8rem;
            padding: 1rem 1.5rem;
            background: transparent;
            border: none;
            border-right: var(--border);
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            transition: all var(--transition);
            white-space: nowrap;
        }

        .content-tab:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .content-tab.active {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        /* Tab Content */
        .tab-content {
            flex: 1;
            overflow-y: auto;
        }

        .tab-panel {
            display: none;
            padding: 2rem;
        }

        .tab-panel.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* ===== STAGE 1: SET THE STAGE ===== */
        .stage-intro {
            max-width: 800px;
            margin: 0 auto;
        }

        .stage-header {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: var(--border-thin);
        }

        .stage-header h2 {
            font-family: 'Syne', sans-serif;
            font-weight: 800;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .stage-header h2 .stage-badge {
            background: var(--accent-coral);
            color: #fff;
            padding: 0.25rem 0.6rem;
            font-size: 0.7rem;
        }

        .stage-header p {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Summary Section */
        .summary-section {
            background: var(--bg-secondary);
            border: var(--border);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .summary-section h3 {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .summary-content {
            font-size: 1.1rem;
            line-height: 1.8;
        }

        .summary-content .typing-cursor {
            display: inline-block;
            width: 2px;
            height: 1.2em;
            background: var(--accent-coral);
            margin-left: 2px;
            animation: blink 0.8s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* Key Concepts Grid */
        .concepts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .concept-card {
            background: var(--bg-secondary);
            border: var(--border);
            box-shadow: var(--card-shadow);
            transition: all var(--transition);
            cursor: pointer;
            overflow: hidden;
        }

        .concept-card:hover {
            transform: translate(-4px, -4px);
            box-shadow: var(--card-shadow-hover);
        }

        .concept-card-header {
            padding: 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: var(--border-thin);
        }

        .concept-card h4 {
            font-family: 'Instrument Serif', serif;
            font-size: 1.3rem;
            line-height: 1.2;
        }

        .complexity-badge {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 0.25rem 0.5rem;
            background: var(--accent-amber);
            color: #1A1A1A;
        }

        .complexity-badge.high { background: var(--accent-coral); color: #fff; }
        .complexity-badge.low { background: var(--accent-mint); color: #1A1A1A; }

        .concept-card-body {
            padding: 1.25rem;
        }

        .concept-card-body p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .concept-card-footer {
            padding: 1rem 1.25rem;
            background: var(--bg-tertiary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-action {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--accent-indigo);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Timeline */
        .timeline-section {
            margin: 2rem 0;
        }

        .timeline-section h3 {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--bg-tertiary);
        }

        .timeline-item {
            position: relative;
            padding-bottom: 2rem;
            padding-left: 2rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -26px;
            top: 4px;
            width: 16px;
            height: 16px;
            background: var(--text-primary);
            border: 3px solid var(--bg-primary);
        }

        .timeline-item.bug-1::before { background: var(--accent-coral); }
        .timeline-item.bug-2::before { background: var(--accent-amber); }
        .timeline-item.bug-3::before { background: var(--accent-plum); }

        .timeline-date {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .timeline-content h4 {
            font-family: 'Syne', sans-serif;
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
        }

        .timeline-content p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* ===== STAGE 2: ELI5 ===== */
        .eli5-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .eli5-card {
            background: var(--bg-secondary);
            border: var(--border);
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .eli5-card-header {
            padding: 1.5rem;
            background: var(--accent-amber);
            color: #1A1A1A;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .eli5-card-header h3 {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .eli5-card-body {
            padding: 2rem;
        }

        .eli5-question {
            font-family: 'Instrument Serif', serif;
            font-size: 1.4rem;
            line-height: 1.4;
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px dashed var(--bg-tertiary);
        }

        .eli5-answer {
            font-size: 1.05rem;
            line-height: 1.8;
            color: var(--text-secondary);
        }

        .analogy-box {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: var(--bg-tertiary);
            border-left: 4px solid var(--accent-indigo);
        }

        .analogy-box h4 {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent-indigo);
            margin-bottom: 0.75rem;
        }

        .analogy-box p {
            font-size: 0.95rem;
            line-height: 1.6;
            font-style: italic;
        }

        /* Level selector */
        .depth-selector {
            display: flex;
            gap: 0;
            margin-bottom: 2rem;
            border: var(--border);
        }

        .depth-btn {
            flex: 1;
            padding: 1rem;
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background: var(--bg-secondary);
            border: none;
            border-right: var(--border);
            cursor: pointer;
            transition: all var(--transition);
            color: var(--text-secondary);
        }

        .depth-btn:last-child {
            border-right: none;
        }

        .depth-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .depth-btn.active {
            background: var(--text-primary);
            color: var(--bg-primary);
        }

        /* ===== STAGE 3: ASSESS ===== */
        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .quiz-progress {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border: var(--border);
        }

        .quiz-progress-bar {
            flex: 1;
            height: 8px;
            background: var(--bg-tertiary);
        }

        .quiz-progress-fill {
            height: 100%;
            background: var(--accent-mint);
            transition: width 0.5s ease;
        }

        .quiz-progress-text {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .quiz-card {
            background: var(--bg-secondary);
            border: var(--border);
            box-shadow: var(--card-shadow);
            overflow: hidden;
        }

        .quiz-card-header {
            padding: 1.5rem;
            background: var(--accent-plum);
            color: #fff;
        }

        .quiz-card-header h3 {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }

        .quiz-question {
            font-family: 'Instrument Serif', serif;
            font-size: 1.4rem;
            line-height: 1.4;
        }

        .quiz-card-body {
            padding: 2rem;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .quiz-option {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1.25rem;
            background: var(--bg-primary);
            border: var(--border);
            cursor: pointer;
            transition: all var(--transition);
        }

        .quiz-option:hover {
            background: var(--bg-tertiary);
        }

        .quiz-option.selected {
            border-color: var(--accent-indigo);
            background: var(--bg-tertiary);
        }

        .quiz-option.correct {
            border-color: var(--accent-mint);
            background: rgba(45, 212, 168, 0.1);
        }

        .quiz-option.incorrect {
            border-color: var(--accent-coral);
            background: rgba(255, 107, 74, 0.1);
        }

        .option-letter {
            width: 32px;
            height: 32px;
            background: var(--text-primary);
            color: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            flex-shrink: 0;
        }

        .quiz-option.correct .option-letter {
            background: var(--accent-mint);
            color: #1A1A1A;
        }

        .quiz-option.incorrect .option-letter {
            background: var(--accent-coral);
            color: #fff;
        }

        .option-text {
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .quiz-explanation {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: var(--bg-tertiary);
            border-left: 4px solid var(--accent-mint);
            display: none;
        }

        .quiz-explanation.visible {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .quiz-explanation h4 {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent-mint);
            margin-bottom: 0.75rem;
        }

        .quiz-actions {
            display: flex;
            justify-content: space-between;
            padding: 1.5rem;
            border-top: var(--border);
        }

        /* ===== STAGE 4: FEYNMAN MODE ===== */
        .feynman-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .feynman-prompt {
            background: var(--bg-secondary);
            border: var(--border);
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
        }

        .feynman-prompt-header {
            padding: 1.5rem;
            background: var(--accent-coral);
            color: #fff;
        }

        .feynman-prompt-header h3 {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .feynman-prompt-header p {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .feynman-topic {
            padding: 2rem;
            text-align: center;
        }

        .feynman-topic h4 {
            font-family: 'Instrument Serif', serif;
            font-size: 1.8rem;
            line-height: 1.3;
            margin-bottom: 1rem;
        }

        .feynman-topic p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .feynman-textarea {
            width: 100%;
            min-height: 250px;
            padding: 1.5rem;
            font-family: 'Space Mono', monospace;
            font-size: 1rem;
            line-height: 1.7;
            background: var(--bg-primary);
            border: var(--border);
            border-top: none;
            color: var(--text-primary);
            resize: vertical;
        }

        .feynman-textarea::placeholder {
            color: var(--text-secondary);
        }

        .feynman-textarea:focus {
            outline: none;
            background: var(--bg-secondary);
        }

        .feynman-actions {
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: var(--border);
        }

        .word-count {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* AI Feedback */
        .ai-feedback {
            background: var(--bg-secondary);
            border: var(--border);
            margin-top: 2rem;
            display: none;
        }

        .ai-feedback.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .ai-feedback-header {
            padding: 1rem 1.5rem;
            background: var(--accent-mint);
            color: #1A1A1A;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .ai-feedback-header h4 {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .ai-feedback-body {
            padding: 1.5rem;
        }

        .feedback-section {
            margin-bottom: 1.5rem;
        }

        .feedback-section:last-child {
            margin-bottom: 0;
        }

        .feedback-section h5 {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feedback-section.strengths h5 { color: var(--accent-mint); }
        .feedback-section.gaps h5 { color: var(--accent-amber); }
        .feedback-section.suggestions h5 { color: var(--accent-indigo); }

        .feedback-section ul {
            list-style: none;
        }

        .feedback-section li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
            line-height: 1.5;
        }

        .feedback-section li::before {
            content: '‚Üí';
            position: absolute;
            left: 0;
            color: var(--text-secondary);
        }

        /* ===== CONCEPT DEEP DIVE MODAL ===== */
        .concept-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 200;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 2rem;
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
        }

        .concept-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .concept-modal {
            background: var(--bg-primary);
            border: var(--border);
            box-shadow: var(--card-shadow-large);
            max-width: 900px;
            width: 100%;
            margin: 2rem 0;
            transform: scale(0.95) translateY(20px);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .concept-modal-overlay.active .concept-modal {
            transform: scale(1) translateY(0);
        }

        .concept-modal-header {
            padding: 2rem;
            border-bottom: var(--border);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .concept-modal-header h2 {
            font-family: 'Instrument Serif', serif;
            font-size: 2rem;
            line-height: 1.2;
        }

        .concept-modal-close {
            width: 50px;
            height: 50px;
            background: var(--bg-secondary);
            border: var(--border);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
            transition: all var(--transition);
        }

        .concept-modal-close:hover {
            background: var(--accent-coral);
            color: #fff;
        }

        .concept-modal-body {
            padding: 2rem;
        }

        .concept-levels {
            display: flex;
            gap: 0;
            margin-bottom: 2rem;
            border: var(--border);
        }

        .level-tab {
            flex: 1;
            padding: 1rem;
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background: var(--bg-secondary);
            border: none;
            border-right: var(--border);
            cursor: pointer;
            transition: all var(--transition);
            color: var(--text-secondary);
            text-align: center;
        }

        .level-tab:last-child {
            border-right: none;
        }

        .level-tab:hover {
            background: var(--bg-tertiary);
        }

        .level-tab.active {
            background: var(--text-primary);
            color: var(--bg-primary);
        }

        .level-content {
            display: none;
        }

        .level-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .level-content h4 {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: var(--border-thin);
        }

        .level-content p {
            font-size: 1.05rem;
            line-height: 1.8;
            margin-bottom: 1.5rem;
        }

        /* First principles */
        .first-principles {
            background: var(--bg-secondary);
            border: var(--border);
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .first-principles h4 {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--accent-plum);
        }

        .principle-item {
            padding: 0.75rem 0;
            border-bottom: 1px dashed var(--bg-tertiary);
            cursor: pointer;
            transition: all var(--transition);
        }

        .principle-item:hover {
            padding-left: 0.5rem;
            color: var(--accent-indigo);
        }

        .principle-item:last-child {
            border-bottom: none;
        }

        /* Chat with concept */
        .concept-chat {
            margin-top: 2rem;
            border: var(--border);
        }

        .chat-header {
            padding: 1rem 1.5rem;
            background: var(--accent-indigo);
            color: #fff;
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chat-messages {
            padding: 1.5rem;
            max-height: 300px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .chat-message {
            display: flex;
            gap: 0.75rem;
            max-width: 85%;
        }

        .chat-message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .chat-avatar {
            width: 32px;
            height: 32px;
            background: var(--text-primary);
            color: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        .chat-message.user .chat-avatar {
            background: var(--accent-indigo);
            color: #fff;
        }

        .chat-bubble {
            padding: 0.75rem 1rem;
            background: var(--bg-secondary);
            border: var(--border-thin);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .chat-message.user .chat-bubble {
            background: var(--accent-indigo);
            color: #fff;
            border-color: var(--accent-indigo);
        }

        .chat-input-container {
            display: flex;
            border-top: var(--border);
        }

        .chat-input {
            flex: 1;
            padding: 1rem;
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            background: var(--bg-primary);
            border: none;
            color: var(--text-primary);
        }

        .chat-input:focus {
            outline: none;
            background: var(--bg-secondary);
        }

        .chat-send {
            padding: 1rem 1.5rem;
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.8rem;
            background: var(--text-primary);
            color: var(--bg-primary);
            border: none;
            cursor: pointer;
            transition: all var(--transition);
        }

        .chat-send:hover {
            background: var(--accent-indigo);
            color: #fff;
        }

        /* ===== BUTTONS ===== */
        .btn {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 0.85rem;
            padding: 1rem 1.5rem;
            border: var(--border);
            cursor: pointer;
            transition: all var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-primary {
            background: var(--text-primary);
            color: var(--bg-primary);
            box-shadow: var(--card-shadow);
        }

        .btn-primary:hover {
            transform: translate(-2px, -2px);
            box-shadow: var(--card-shadow-hover);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
        }

        .btn-accent {
            background: var(--accent-coral);
            color: #fff;
            box-shadow: var(--card-shadow);
        }

        .btn-accent:hover {
            transform: translate(-2px, -2px);
            box-shadow: var(--card-shadow-hover);
        }

        /* ===== LOADING STATE ===== */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: var(--bg-primary);
            z-index: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--bg-tertiary);
            border-top-color: var(--accent-coral);
            animation: spin 1s linear infinite;
            margin-bottom: 2rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-family: 'Syne', sans-serif;
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .loading-subtext {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .loading-steps {
            margin-top: 2rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .loading-step {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
            opacity: 0.5;
            transition: all 0.3s ease;
        }

        .loading-step.active {
            opacity: 1;
            color: var(--text-primary);
        }

        .loading-step.complete {
            color: var(--accent-mint);
        }

        .loading-step-icon {
            width: 20px;
            height: 20px;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .loading-step.active .loading-step-icon {
            background: var(--accent-coral);
            color: #fff;
            animation: pulse 1s ease infinite;
        }

        .loading-step.complete .loading-step-icon {
            background: var(--accent-mint);
            color: #1A1A1A;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 75px;
                bottom: 0;
                z-index: 50;
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .sidebar-toggle {
                display: flex;
            }
        }

        @media (max-width: 768px) {
            header {
                padding: 1rem;
            }

            .logo {
                font-size: 1.2rem;
            }

            .logo-icon {
                width: 32px;
                height: 32px;
            }

            .landing-view {
                padding: 1.5rem;
            }

            .url-input-container {
                flex-direction: column;
            }

            .url-input {
                border-right: var(--border);
                border-bottom: none;
            }

            .article-header {
                padding: 1.5rem;
            }

            .tab-panel {
                padding: 1.5rem;
            }

            .concepts-grid {
                grid-template-columns: 1fr;
            }

            .concept-modal {
                margin: 1rem;
            }

            .concept-levels {
                flex-direction: column;
            }

            .level-tab {
                border-right: none;
                border-bottom: var(--border);
            }

            .level-tab:last-child {
                border-bottom: none;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Analyzing Article</div>
        <div class="loading-subtext">Building your learning experience...</div>
        <div class="loading-steps">
            <div class="loading-step" data-step="1">
                <span class="loading-step-icon">1</span>
                <span>Fetching article content</span>
            </div>
            <div class="loading-step" data-step="2">
                <span class="loading-step-icon">2</span>
                <span>Extracting key concepts</span>
            </div>
            <div class="loading-step" data-step="3">
                <span class="loading-step-icon">3</span>
                <span>Building concept relationships</span>
            </div>
            <div class="loading-step" data-step="4">
                <span class="loading-step-icon">4</span>
                <span>Generating learning materials</span>
            </div>
        </div>
    </div>

    <header>
        <h1 class="logo" onclick="showLanding()">
            <span class="logo-icon">üìö</span>
            DEEP READER
        </h1>
        <div class="header-actions">
            <button class="icon-btn" id="sidebarToggle" title="Toggle sidebar">‚ò∞</button>
            <button class="icon-btn" id="themeToggle" title="Toggle theme">‚òÄÔ∏è</button>
        </div>
    </header>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-section">
                <h3 class="sidebar-title">üß† Feynman Learning Path</h3>
                <div class="learning-stage">
                    <div class="stage-item active" data-stage="1" onclick="goToStage(1)">
                        <span class="stage-number">1</span>
                        <div class="stage-info">
                            <h4>Set the Stage</h4>
                            <p>Overview & Key Concepts</p>
                        </div>
                    </div>
                    <div class="stage-item" data-stage="2" onclick="goToStage(2)">
                        <span class="stage-number">2</span>
                        <div class="stage-info">
                            <h4>ELI5</h4>
                            <p>Simple Explanations</p>
                        </div>
                    </div>
                    <div class="stage-item" data-stage="3" onclick="goToStage(3)">
                        <span class="stage-number">3</span>
                        <div class="stage-info">
                            <h4>Assess & Study</h4>
                            <p>Test Understanding</p>
                        </div>
                    </div>
                    <div class="stage-item" data-stage="4" onclick="goToStage(4)">
                        <span class="stage-number">4</span>
                        <div class="stage-info">
                            <h4>Teach Back</h4>
                            <p>Feynman Technique</p>
                        </div>
                    </div>
                </div>

                <div class="retention-meter">
                    <div class="retention-label">
                        <span>Retention Estimate</span>
                        <span id="retentionPercent">10%</span>
                    </div>
                    <div class="retention-bar">
                        <div class="retention-fill" id="retentionFill" style="width: 10%"></div>
                    </div>
                    <div class="retention-markers">
                        <span>Reading</span>
                        <span>Practice</span>
                        <span>Teaching</span>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">üìå Key Concepts</h3>
                <div class="concepts-list" id="conceptsList">
                    <!-- Populated dynamically -->
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Landing View -->
            <div class="landing-view" id="landingView">
                <div class="landing-hero">
                    <h1>Master <em>Complex</em> Knowledge</h1>
                    <p>
                        Transform any technical article into a deep learning experience.
                        Using the Feynman Technique, we'll help you truly understand‚Äînot just read‚Äî
                        complex engineering content. Go from 10% retention to 90%.
                    </p>

                    <div class="url-input-container">
                        <input
                            type="url"
                            class="url-input"
                            id="articleUrl"
                            placeholder="Paste article URL (e.g., engineering blog, research paper...)"
                            value="https://www.anthropic.com/engineering/a-postmortem-of-three-recent-issues"
                        >
                        <button class="analyze-btn" id="analyzeBtn" onclick="analyzeArticle()">
                            Analyze ‚Üí
                        </button>
                    </div>
                </div>

                <div class="landing-features">
                    <div class="feature-card">
                        <h3>üéØ Stage 1: Set the Stage</h3>
                        <p>Get a structured overview, identify key concepts, and build your initial knowledge map.</p>
                    </div>
                    <div class="feature-card">
                        <h3>üë∂ Stage 2: ELI5</h3>
                        <p>Break down complex ideas into simple language. Real-world analogies and first principles.</p>
                    </div>
                    <div class="feature-card">
                        <h3>üß™ Stage 3: Assess</h3>
                        <p>Test your understanding with generated questions. Find and fill knowledge gaps.</p>
                    </div>
                    <div class="feature-card">
                        <h3>üéì Stage 4: Teach Back</h3>
                        <p>Explain concepts in your own words. AI evaluates and helps refine your understanding.</p>
                    </div>
                </div>
            </div>

            <!-- Reader View -->
            <div class="reader-view" id="readerView">
                <!-- Article Header -->
                <div class="article-header">
                    <div class="article-meta">
                        <span class="meta-tag">Engineering</span>
                        <span class="meta-tag">Postmortem</span>
                        <span class="meta-tag">Infrastructure</span>
                    </div>
                    <h1 class="article-title" id="articleTitle">A Postmortem of Three Recent Issues</h1>
                    <div class="article-stats">
                        <span>üìñ ~15 min read</span>
                        <span>üß† 12 key concepts</span>
                        <span>üìÖ September 2025</span>
                    </div>
                </div>

                <!-- Content Tabs -->
                <div class="content-tabs">
                    <button class="content-tab active" data-tab="stage1" onclick="switchTab('stage1')">
                        1. Set the Stage
                    </button>
                    <button class="content-tab" data-tab="stage2" onclick="switchTab('stage2')">
                        2. ELI5
                    </button>
                    <button class="content-tab" data-tab="stage3" onclick="switchTab('stage3')">
                        3. Assess & Study
                    </button>
                    <button class="content-tab" data-tab="stage4" onclick="switchTab('stage4')">
                        4. Teach Back
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Stage 1: Set the Stage -->
                    <div class="tab-panel active" data-panel="stage1">
                        <div class="stage-intro">
                            <div class="stage-header">
                                <h2>
                                    <span class="stage-badge">STAGE 1</span>
                                    Set the Stage
                                </h2>
                                <p>
                                    Start by building context. What's this article about? What are the key concepts
                                    you need to understand? Write down what you already know before diving deeper.
                                </p>
                            </div>

                            <!-- Summary -->
                            <div class="summary-section">
                                <h3>‚ú¶ Article Summary</h3>
                                <div class="summary-content" id="summaryContent">
                                    <!-- AI-generated summary with typing effect -->
                                </div>
                            </div>

                            <!-- Key Concepts Grid -->
                            <h3 style="font-family: 'Syne', sans-serif; font-weight: 700; font-size: 1rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                                üìå Key Concepts to Master
                            </h3>
                            <div class="concepts-grid" id="conceptsGrid">
                                <!-- Generated dynamically -->
                            </div>

                            <!-- Timeline -->
                            <div class="timeline-section">
                                <h3>üìÖ Timeline of Events</h3>
                                <div class="timeline" id="timeline">
                                    <!-- Generated dynamically -->
                                </div>
                            </div>

                            <div style="text-align: center; margin-top: 3rem;">
                                <button class="btn btn-accent" onclick="goToStage(2)">
                                    Continue to ELI5 ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Stage 2: ELI5 -->
                    <div class="tab-panel" data-panel="stage2">
                        <div class="eli5-container">
                            <div class="stage-header">
                                <h2>
                                    <span class="stage-badge">STAGE 2</span>
                                    Explain Like I'm 5
                                </h2>
                                <p>
                                    Now let's break down each concept into simple language. Can you explain it
                                    without jargon? If not, that's where your gaps are.
                                </p>
                            </div>

                            <div class="depth-selector">
                                <button class="depth-btn active" data-depth="eli5" onclick="setDepth('eli5')">
                                    üë∂ ELI5
                                </button>
                                <button class="depth-btn" data-depth="intermediate" onclick="setDepth('intermediate')">
                                    üéì Intermediate
                                </button>
                                <button class="depth-btn" data-depth="expert" onclick="setDepth('expert')">
                                    üî¨ Expert
                                </button>
                            </div>

                            <div id="eli5Content">
                                <!-- Generated dynamically -->
                            </div>

                            <div style="text-align: center; margin-top: 3rem;">
                                <button class="btn btn-secondary" onclick="goToStage(1)">
                                    ‚Üê Back
                                </button>
                                <button class="btn btn-accent" onclick="goToStage(3)" style="margin-left: 1rem;">
                                    Continue to Assessment ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Stage 3: Assess -->
                    <div class="tab-panel" data-panel="stage3">
                        <div class="quiz-container">
                            <div class="stage-header">
                                <h2>
                                    <span class="stage-badge">STAGE 3</span>
                                    Assess & Study
                                </h2>
                                <p>
                                    Time to test your understanding. These questions will reveal gaps in your
                                    knowledge. Don't worry about getting them wrong‚Äîthat's how we learn!
                                </p>
                            </div>

                            <div class="quiz-progress">
                                <div class="quiz-progress-bar">
                                    <div class="quiz-progress-fill" id="quizProgressFill" style="width: 0%"></div>
                                </div>
                                <span class="quiz-progress-text" id="quizProgressText">Question 1 of 5</span>
                            </div>

                            <div id="quizContent">
                                <!-- Generated dynamically -->
                            </div>

                            <div style="text-align: center; margin-top: 3rem;">
                                <button class="btn btn-secondary" onclick="goToStage(2)">
                                    ‚Üê Back to ELI5
                                </button>
                                <button class="btn btn-accent" onclick="goToStage(4)" style="margin-left: 1rem;">
                                    Continue to Teach Back ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Stage 4: Feynman Teach Back -->
                    <div class="tab-panel" data-panel="stage4">
                        <div class="feynman-container">
                            <div class="stage-header">
                                <h2>
                                    <span class="stage-badge">STAGE 4</span>
                                    Teach Back (Feynman Technique)
                                </h2>
                                <p>
                                    The ultimate test: explain this concept as if teaching someone who knows nothing
                                    about it. Use simple language. No jargon. If you can do this, you truly understand.
                                </p>
                            </div>

                            <div class="feynman-prompt">
                                <div class="feynman-prompt-header">
                                    <h3>üéØ Your Challenge</h3>
                                    <p>Explain this concept to a curious friend who has no technical background</p>
                                </div>
                                <div class="feynman-topic">
                                    <h4 id="feynmanTopic">Why did three bugs affect Claude's response quality?</h4>
                                    <p>Think about: What happened? Why? What was the impact? What did they learn?</p>
                                </div>
                                <textarea
                                    class="feynman-textarea"
                                    id="feynmanTextarea"
                                    placeholder="Start explaining in your own words... Remember: if you can't explain it simply, you don't understand it well enough."
                                    oninput="updateWordCount()"
                                ></textarea>
                                <div class="feynman-actions">
                                    <span class="word-count"><span id="wordCount">0</span> words</span>
                                    <button class="btn btn-primary" onclick="submitFeynman()">
                                        Get AI Feedback ‚Üí
                                    </button>
                                </div>
                            </div>

                            <div class="ai-feedback" id="aiFeedback">
                                <div class="ai-feedback-header">
                                    <span>ü§ñ</span>
                                    <h4>AI Evaluation of Your Explanation</h4>
                                </div>
                                <div class="ai-feedback-body" id="aiFeedbackBody">
                                    <!-- Generated dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Concept Deep Dive Modal -->
    <div class="concept-modal-overlay" id="conceptModal">
        <div class="concept-modal">
            <div class="concept-modal-header">
                <div>
                    <span class="meta-tag" id="conceptModalCategory">Technical</span>
                    <h2 id="conceptModalTitle">Concept Title</h2>
                </div>
                <button class="concept-modal-close" onclick="closeConceptModal()">√ó</button>
            </div>
            <div class="concept-modal-body">
                <div class="concept-levels">
                    <button class="level-tab active" data-level="eli5" onclick="setConceptLevel('eli5')">
                        üë∂ ELI5
                    </button>
                    <button class="level-tab" data-level="technical" onclick="setConceptLevel('technical')">
                        üîß Technical
                    </button>
                    <button class="level-tab" data-level="deep" onclick="setConceptLevel('deep')">
                        üî¨ Deep Dive
                    </button>
                </div>

                <div id="conceptLevelContent">
                    <!-- Generated dynamically -->
                </div>

                <div class="first-principles" id="firstPrinciples">
                    <h4>üå± First Principles</h4>
                    <div id="principlesList">
                        <!-- Generated dynamically -->
                    </div>
                </div>

                <div class="concept-chat">
                    <div class="chat-header">
                        <span>üí¨</span>
                        Ask anything about this concept
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-message">
                            <div class="chat-avatar">AI</div>
                            <div class="chat-bubble">
                                I'm here to help you understand this concept deeply. Ask me anything‚Äîwhy something works,
                                real-world examples, or how it connects to other ideas!
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <input
                            type="text"
                            class="chat-input"
                            id="chatInput"
                            placeholder="Ask a question..."
                            onkeypress="handleChatKeypress(event)"
                        >
                        <button class="chat-send" onclick="sendChatMessage()">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== DATA =====
        const articleData = {
            title: "A Postmortem of Three Recent Issues",
            source: "Anthropic Engineering",
            summary: `Between August and early September 2025, Anthropic experienced three overlapping infrastructure bugs that intermittently degraded Claude's response quality. This wasn't about reducing quality due to demand‚Äîthese were genuine infrastructure bugs that affected how Claude processed requests across different hardware platforms (AWS Trainium, NVIDIA GPUs, Google TPUs). The postmortem reveals the complexity of serving AI at scale and the challenges of maintaining consistent quality across distributed systems.`,
            concepts: [
                {
                    id: 1,
                    name: "Context Window Routing",
                    complexity: "medium",
                    category: "Infrastructure",
                    summary: "How requests are directed to appropriate servers based on context length requirements",
                    eli5: "Imagine a library with different sized reading rooms. Small questions go to small rooms, big questions need the big room. But someone accidentally put signs pointing small questions to the big room, and the big room wasn't ready for them.",
                    technical: "Requests to Claude are routed to different server configurations based on the expected context window size. The 1M token context window servers have different memory and processing configurations than standard servers. A routing misconfiguration caused requests to be sent to servers configured for a different context window than requested.",
                    deep: "The routing layer uses a combination of request metadata and load balancing algorithms to direct traffic. When preparing infrastructure for the new 1M token context window, certain routing rules were updated prematurely. The initial bug affected 0.8% of Sonnet 4 requests, but a load balancing change on August 29 amplified this to 16% at peak. The 'sticky' nature of routing meant affected users remained on problematic servers for follow-up requests.",
                    firstPrinciples: [
                        "What is load balancing and why is it needed?",
                        "How do distributed systems route requests?",
                        "What is a context window in language models?"
                    ]
                },
                {
                    id: 2,
                    name: "XLA:TPU Compilation",
                    complexity: "high",
                    category: "Deep ML",
                    summary: "How machine learning code gets optimized and compiled for TPU hardware",
                    eli5: "Think of XLA as a translator that converts recipes into a specific kitchen's language. But this translator was making tiny math mistakes‚Äîlike saying '2.001 cups' instead of '2 cups'. Usually no big deal, but sometimes it made the chef pick the completely wrong ingredient.",
                    technical: "XLA (Accelerated Linear Algebra) is a compiler that optimizes machine learning computations for specific hardware like Google's TPUs. It transforms high-level operations into efficient hardware instructions. The bug involved precision mismatches between bf16 (brain floating point) and fp32 (standard 32-bit floating point) operations.",
                    deep: "Claude models perform probability calculations in bf16 for efficiency, but TPU vector processors are fp32-native. XLA optimizes by converting some operations to fp32, controlled by the `xla_allow_excess_precision` flag. The bug manifested when precision inconsistencies caused disagreement about which token had the highest probability. An 'approximate top-k' operation sometimes returned completely wrong results for specific batch sizes and model configurations.",
                    firstPrinciples: [
                        "What is floating point precision?",
                        "How do compilers optimize code?",
                        "What is bf16 vs fp32?",
                        "How do language models select output tokens?"
                    ]
                },
                {
                    id: 3,
                    name: "Token Selection (Top-k Sampling)",
                    complexity: "medium",
                    category: "ML Fundamentals",
                    summary: "How language models choose the next word from probability distributions",
                    eli5: "Imagine you're playing a word game where you need to pick the next word in a sentence. You have a bag of words, each with different chances of being picked. Top-k sampling means you only consider the 10 most likely words, ignoring weird options like 'banana' when you're writing about code.",
                    technical: "Top-k sampling is a decoding strategy where the model only considers the k tokens with highest probability at each step, then samples from this reduced distribution. This balances between pure greedy decoding (always pick highest) and unrestricted sampling (consider all tokens).",
                    deep: "The bug occurred in the 'approximate top-k' implementation, which uses a faster but less precise algorithm. When mixed precision arithmetic caused slight probability differences, some operations disagreed on which tokens belonged in the top-k set. In edge cases, the highest probability token could be eliminated entirely from consideration, leading to unexpected outputs like Thai characters in English text.",
                    firstPrinciples: [
                        "What is a probability distribution?",
                        "How do neural networks generate text?",
                        "What is the difference between greedy and sampling decoding?"
                    ]
                },
                {
                    id: 4,
                    name: "Output Corruption Bug",
                    complexity: "medium",
                    category: "Bug Analysis",
                    summary: "A runtime optimization error causing unexpected characters in responses",
                    eli5: "Imagine a printer that sometimes glitches and prints Chinese characters when you're writing in English. The printer's internal settings got scrambled, so occasionally it would 'think' a Chinese character was more likely than the English letter you wanted.",
                    technical: "A misconfiguration on Claude API TPU servers caused runtime performance optimization errors. The system occasionally assigned high probability to tokens that should rarely occur given the context‚Äîproducing Thai/Chinese characters in English responses or syntax errors in code.",
                    deep: "The corruption was intermittent and depended on specific combinations of input patterns and server states. Detection was complicated by the fact that Claude's error recovery mechanisms often masked single corrupted tokens. The bug was identified and rolled back September 2, with additional detection tests added to catch unexpected character outputs in deployment testing.",
                    firstPrinciples: [
                        "How do runtime optimizations work?",
                        "What is token encoding in language models?",
                        "How do systems detect anomalous outputs?"
                    ]
                },
                {
                    id: 5,
                    name: "bf16 vs fp32 Precision",
                    complexity: "high",
                    category: "Deep ML",
                    summary: "Different number formats used in machine learning and their trade-offs",
                    eli5: "Imagine you're measuring ingredients. fp32 is like using a scientific scale that shows 3.14159265 grams. bf16 is like a kitchen scale that just shows 3.1 grams. Usually close enough! But sometimes that tiny difference‚Äîwhen you're comparing two almost-equal things‚Äîmakes you pick the wrong one.",
                    technical: "bf16 (brain floating point 16) uses 1 sign bit, 8 exponent bits, and 7 mantissa bits, offering the same range as fp32 but with reduced precision. fp32 uses 1 sign bit, 8 exponent bits, and 23 mantissa bits. bf16 is popular in ML because it halves memory usage while maintaining numeric range.",
                    deep: "The precision mismatch becomes critical when comparing very close values. If two tokens have probabilities 0.1234567 and 0.1234568 in fp32, they might both round to 0.1235 in bf16. When one operation uses fp32 and another uses bf16, they can disagree on which is larger. The XLA compiler's `xla_allow_excess_precision` flag controls whether operations can use higher precision than requested.",
                    firstPrinciples: [
                        "How do computers represent decimal numbers?",
                        "What is floating point arithmetic?",
                        "Why does precision matter in ML?"
                    ]
                },
                {
                    id: 6,
                    name: "Multi-Platform Serving",
                    complexity: "medium",
                    category: "Infrastructure",
                    summary: "Running the same AI model across different hardware and cloud providers",
                    eli5: "Imagine you're a chef who needs to cook the same recipe in three different kitchens‚Äîone with a gas stove, one electric, one with a fancy induction cooktop. You need the food to taste identical no matter which kitchen you're in. That's hard when each kitchen has slightly different quirks!",
                    technical: "Anthropic serves Claude across AWS Trainium, NVIDIA GPUs, and Google TPUs, plus multiple distribution channels (Claude API, Amazon Bedrock, Google Cloud Vertex AI). Maintaining strict quality equivalence requires ensuring identical behavior despite hardware differences.",
                    deep: "Different hardware platforms have different numerical behaviors, compilation pipelines, and optimization strategies. The three bugs manifested at different rates across platforms: the routing bug affected Claude API more than Bedrock/Vertex, while the TPU bugs only affected TPU-served requests. This platform variance created confusing signals during debugging, with some users experiencing issues while others didn't.",
                    firstPrinciples: [
                        "What are TPUs, GPUs, and custom AI accelerators?",
                        "How does cloud infrastructure work?",
                        "What does 'platform parity' mean?"
                    ]
                }
            ],
            timeline: [
                { date: "August 5", event: "Bug 1 begins", description: "Context window routing error starts affecting 0.8% of Sonnet 4 requests", type: "bug-1" },
                { date: "August 21", event: "Code deployment", description: "Update intended to improve token selection inadvertently triggers latent XLA bug", type: "bug-3" },
                { date: "August 25", event: "Bug 2 & 3 start", description: "Output corruption begins on Opus models; XLA miscompilation affects TPU servers", type: "bug-2" },
                { date: "August 29", event: "Load balancer change", description: "Routing bug impact dramatically worsens, now affecting 16% of Sonnet 4 requests at peak", type: "bug-1" },
                { date: "September 2", event: "Bug 2 fixed", description: "Output corruption identified and rolled back for Sonnet 4", type: "fix" },
                { date: "September 4", event: "Bug 1 fix deployed", description: "Routing logic fixed, beginning rollout", type: "fix" },
                { date: "September 12", event: "Bug 3 fixed", description: "Switched from approximate to exact top-k, standardized fp32 precision", type: "fix" },
                { date: "September 18", event: "Full resolution", description: "All fixes fully rolled out across all platforms", type: "fix" }
            ],
            quizzes: [
                {
                    question: "Why did the routing bug affect some users more than others for extended periods?",
                    options: [
                        { text: "Random load balancing distributed errors evenly", letter: "A" },
                        { text: "'Sticky' routing kept affected users on problematic servers for follow-up requests", letter: "B" },
                        { text: "Only premium users were affected", letter: "C" },
                        { text: "The bug only occurred during peak hours", letter: "D" }
                    ],
                    correct: "B",
                    explanation: "The routing had 'sticky' behavior, meaning once a user was routed to a misconfigured server, their subsequent requests in that session continued going to the same server. This is why approximately 30% of Claude Code users experienced at least one misrouted message‚Äîonce hit, they stayed on the wrong path."
                },
                {
                    question: "What was the root cause of the XLA:TPU miscompilation bug?",
                    options: [
                        { text: "A hardware failure in Google's TPU chips", letter: "A" },
                        { text: "Precision mismatches between bf16 and fp32 in the approximate top-k operation", letter: "B" },
                        { text: "Insufficient server memory", letter: "C" },
                        { text: "Network latency issues", letter: "D" }
                    ],
                    correct: "B",
                    explanation: "The bug involved mixed precision arithmetic where bf16 (used by Claude for efficiency) and fp32 (native to TPU vector processors) operations disagreed on which token had the highest probability. The 'approximate top-k' operation would sometimes return completely wrong results due to these precision inconsistencies."
                },
                {
                    question: "Why was it difficult to detect these bugs through internal testing?",
                    options: [
                        { text: "Anthropic doesn't do internal testing", letter: "A" },
                        { text: "The bugs only appeared on production hardware", letter: "B" },
                        { text: "Internal benchmarks didn't capture the degradation, and privacy controls limited debugging access", letter: "C" },
                        { text: "The bugs were too rare to measure", letter: "D" }
                    ],
                    correct: "C",
                    explanation: "Two key factors: First, internal evaluations failed to capture the degradation users reported (partly because Claude recovers well from isolated errors). Second, privacy controls limiting engineer access to unreported user interactions prevented direct debugging. The platform variance created confusing contradictory reports."
                },
                {
                    question: "What symptom did the output corruption bug cause?",
                    options: [
                        { text: "Responses were slower than normal", letter: "A" },
                        { text: "Claude refused to answer questions", letter: "B" },
                        { text: "Thai/Chinese characters appeared in English responses, and syntax errors in code", letter: "C" },
                        { text: "Responses were truncated early", letter: "D" }
                    ],
                    correct: "C",
                    explanation: "The output corruption bug caused the system to occasionally assign high probability to tokens that should rarely occur given context. This manifested as unexpected Thai/Chinese characters appearing in English responses, or syntax errors in generated code‚Äîessentially picking 'wrong' tokens that didn't belong."
                },
                {
                    question: "What change did Anthropic make to fix the XLA precision bug permanently?",
                    options: [
                        { text: "Disabled all TPU usage", letter: "A" },
                        { text: "Switched from approximate to exact top-k and standardized on fp32 precision", letter: "B" },
                        { text: "Added more GPUs to handle load", letter: "C" },
                        { text: "Reduced the model size", letter: "D" }
                    ],
                    correct: "B",
                    explanation: "Anthropic switched from the approximate top-k operation (which was faster but had edge case bugs) to an exact top-k operation, and standardized operations on fp32 precision. They accepted a minor efficiency impact, prioritizing quality over speed."
                }
            ]
        };

        let currentStage = 1;
        let currentQuiz = 0;
        let quizAnswers = {};
        let currentConceptId = null;
        let currentDepth = 'eli5';

        // ===== THEME =====
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('themeToggle').textContent = savedTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
        }

        function toggleTheme() {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
            document.getElementById('themeToggle').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
        }

        document.getElementById('themeToggle').addEventListener('click', toggleTheme);

        // ===== SIDEBAR TOGGLE =====
        document.getElementById('sidebarToggle').addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('open');
        });

        // ===== NAVIGATION =====
        function showLanding() {
            document.getElementById('landingView').style.display = 'flex';
            document.getElementById('readerView').classList.remove('active');
        }

        function showReader() {
            document.getElementById('landingView').style.display = 'none';
            document.getElementById('readerView').classList.add('active');
        }

        // ===== ARTICLE ANALYSIS =====
        async function analyzeArticle() {
            const url = document.getElementById('articleUrl').value;
            if (!url) return;

            const loading = document.getElementById('loadingOverlay');
            loading.classList.add('active');

            // Simulate loading steps
            const steps = loading.querySelectorAll('.loading-step');
            for (let i = 0; i < steps.length; i++) {
                await delay(800);
                if (i > 0) steps[i-1].classList.remove('active');
                if (i > 0) steps[i-1].classList.add('complete');
                steps[i].classList.add('active');
            }
            await delay(800);
            steps[steps.length - 1].classList.remove('active');
            steps[steps.length - 1].classList.add('complete');
            await delay(500);

            loading.classList.remove('active');
            steps.forEach(s => {
                s.classList.remove('active', 'complete');
            });

            showReader();
            initializeContent();
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ===== CONTENT INITIALIZATION =====
        function initializeContent() {
            renderSidebarConcepts();
            renderSummary();
            renderConceptsGrid();
            renderTimeline();
            renderELI5Content();
            renderQuiz();
            updateRetention(10);
        }

        function renderSidebarConcepts() {
            const list = document.getElementById('conceptsList');
            list.innerHTML = articleData.concepts.map(c => `
                <div class="concept-item" data-mastery="low" onclick="openConceptModal(${c.id})">
                    <span class="concept-icon">${c.name.charAt(0)}</span>
                    <span>${c.name}</span>
                </div>
            `).join('');
        }

        function renderSummary() {
            const content = document.getElementById('summaryContent');
            typeText(content, articleData.summary, 10);
        }

        function renderConceptsGrid() {
            const grid = document.getElementById('conceptsGrid');
            grid.innerHTML = articleData.concepts.map(c => `
                <div class="concept-card" onclick="openConceptModal(${c.id})">
                    <div class="concept-card-header">
                        <h4>${c.name}</h4>
                        <span class="complexity-badge ${c.complexity}">${c.complexity}</span>
                    </div>
                    <div class="concept-card-body">
                        <p>${c.summary}</p>
                    </div>
                    <div class="concept-card-footer">
                        <span class="meta-tag" style="font-size: 0.65rem; padding: 0.2rem 0.4rem;">${c.category}</span>
                        <span class="card-action">Deep Dive ‚Üí</span>
                    </div>
                </div>
            `).join('');
        }

        function renderTimeline() {
            const timeline = document.getElementById('timeline');
            timeline.innerHTML = articleData.timeline.map(t => `
                <div class="timeline-item ${t.type}">
                    <div class="timeline-date">${t.date}</div>
                    <div class="timeline-content">
                        <h4>${t.event}</h4>
                        <p>${t.description}</p>
                    </div>
                </div>
            `).join('');
        }

        function renderELI5Content() {
            const container = document.getElementById('eli5Content');
            container.innerHTML = articleData.concepts.slice(0, 4).map((c, i) => `
                <div class="eli5-card" style="animation-delay: ${i * 0.1}s">
                    <div class="eli5-card-header">
                        <span style="font-size: 1.5rem;">üí°</span>
                        <h3>${c.name}</h3>
                    </div>
                    <div class="eli5-card-body">
                        <div class="eli5-question">${c.summary}</div>
                        <div class="eli5-answer" data-depth="eli5">
                            ${c.eli5}
                        </div>
                        <div class="eli5-answer hidden" data-depth="intermediate">
                            ${c.technical}
                        </div>
                        <div class="eli5-answer hidden" data-depth="expert">
                            ${c.deep}
                        </div>
                        <div class="analogy-box">
                            <h4>üéØ Real-World Analogy</h4>
                            <p>${getAnalogy(c.id)}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getAnalogy(conceptId) {
            const analogies = {
                1: "Like a GPS system that accidentally routes city traffic through a mountain road tunnel‚Äîthe tunnel works, but it's not configured for rush hour volume.",
                2: "Like a universal translator that's 99.9% accurate, but occasionally translates 'I love you' as 'I loathe you' because of how it rounds numbers internally.",
                3: "Like an autocomplete that only shows you the top 10 suggestions. Usually smart, but if there's a glitch in measuring popularity, you might never see the option you actually want.",
                4: "Like a word processor with a corrupt font file‚Äîit displays correctly 99% of the time, but occasionally renders your 'e' as a Chinese character.",
                5: "Like comparing prices with a calculator that shows cents vs. one that only shows dollars. Usually they agree, but sometimes $1.994 rounds up on one and down on the other.",
                6: "Like McDonald's ensuring a Big Mac tastes the same whether made in Tokyo, Paris, or New York‚Äîdespite different kitchens, suppliers, and cooking equipment."
            };
            return analogies[conceptId] || "A precise digital system where tiny rounding differences can cascade into unexpected outcomes.";
        }

        function setDepth(depth) {
            currentDepth = depth;
            document.querySelectorAll('.depth-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.depth === depth);
            });
            document.querySelectorAll('.eli5-answer').forEach(el => {
                el.classList.toggle('hidden', el.dataset.depth !== depth);
            });
        }

        // ===== QUIZ =====
        function renderQuiz() {
            const quiz = articleData.quizzes[currentQuiz];
            const container = document.getElementById('quizContent');

            document.getElementById('quizProgressText').textContent = `Question ${currentQuiz + 1} of ${articleData.quizzes.length}`;
            document.getElementById('quizProgressFill').style.width = `${(currentQuiz / articleData.quizzes.length) * 100}%`;

            container.innerHTML = `
                <div class="quiz-card">
                    <div class="quiz-card-header">
                        <h3>Question ${currentQuiz + 1}</h3>
                        <p class="quiz-question">${quiz.question}</p>
                    </div>
                    <div class="quiz-card-body">
                        <div class="quiz-options">
                            ${quiz.options.map(opt => `
                                <div class="quiz-option" data-letter="${opt.letter}" onclick="selectOption('${opt.letter}')">
                                    <span class="option-letter">${opt.letter}</span>
                                    <span class="option-text">${opt.text}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="quiz-explanation" id="quizExplanation">
                            <h4>Explanation</h4>
                            <p>${quiz.explanation}</p>
                        </div>
                    </div>
                    <div class="quiz-actions">
                        <button class="btn btn-secondary" onclick="prevQuiz()" ${currentQuiz === 0 ? 'disabled' : ''}>
                            ‚Üê Previous
                        </button>
                        <button class="btn btn-primary" onclick="nextQuiz()">
                            ${currentQuiz === articleData.quizzes.length - 1 ? 'Finish' : 'Next ‚Üí'}
                        </button>
                    </div>
                </div>
            `;
        }

        function selectOption(letter) {
            const quiz = articleData.quizzes[currentQuiz];
            const options = document.querySelectorAll('.quiz-option');

            options.forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
                if (opt.dataset.letter === letter) {
                    opt.classList.add('selected');
                    opt.classList.add(letter === quiz.correct ? 'correct' : 'incorrect');
                }
                if (opt.dataset.letter === quiz.correct) {
                    opt.classList.add('correct');
                }
            });

            document.getElementById('quizExplanation').classList.add('visible');
            quizAnswers[currentQuiz] = letter;
        }

        function nextQuiz() {
            if (currentQuiz < articleData.quizzes.length - 1) {
                currentQuiz++;
                renderQuiz();
            } else {
                updateRetention(75);
            }
        }

        function prevQuiz() {
            if (currentQuiz > 0) {
                currentQuiz--;
                renderQuiz();
            }
        }

        // ===== FEYNMAN =====
        function updateWordCount() {
            const text = document.getElementById('feynmanTextarea').value;
            const words = text.trim() ? text.trim().split(/\s+/).length : 0;
            document.getElementById('wordCount').textContent = words;
        }

        function submitFeynman() {
            const text = document.getElementById('feynmanTextarea').value;
            if (!text.trim()) return;

            const feedback = document.getElementById('aiFeedback');
            const body = document.getElementById('aiFeedbackBody');

            // Simulated AI feedback
            body.innerHTML = `
                <div class="feedback-section strengths">
                    <h5>‚úì Strengths</h5>
                    <ul>
                        <li>Good use of simple language to explain complex concepts</li>
                        <li>Connected the bugs to real-world impact on users</li>
                        <li>Showed understanding of the cause-and-effect chain</li>
                    </ul>
                </div>
                <div class="feedback-section gaps">
                    <h5>‚ö† Knowledge Gaps Detected</h5>
                    <ul>
                        <li>Consider explaining WHY precision differences matter in more detail</li>
                        <li>The relationship between XLA compilation and token selection could be clearer</li>
                        <li>Try adding an analogy for the "sticky routing" concept</li>
                    </ul>
                </div>
                <div class="feedback-section suggestions">
                    <h5>‚Üí Suggestions to Deepen Understanding</h5>
                    <ul>
                        <li>Review the concept of floating-point precision‚Äîthis is fundamental to the bug</li>
                        <li>Try explaining the timeline of events to reinforce the sequence</li>
                        <li>Consider: How would YOU have detected these bugs earlier?</li>
                    </ul>
                </div>
            `;

            feedback.classList.add('visible');
            updateRetention(90);
        }

        // ===== CONCEPT MODAL =====
        function openConceptModal(id) {
            currentConceptId = id;
            const concept = articleData.concepts.find(c => c.id === id);

            document.getElementById('conceptModalTitle').textContent = concept.name;
            document.getElementById('conceptModalCategory').textContent = concept.category;

            setConceptLevel('eli5');
            renderFirstPrinciples(concept);

            document.getElementById('conceptModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeConceptModal() {
            document.getElementById('conceptModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function setConceptLevel(level) {
            const concept = articleData.concepts.find(c => c.id === currentConceptId);

            document.querySelectorAll('.level-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.level === level);
            });

            const content = document.getElementById('conceptLevelContent');
            let text, title;

            switch(level) {
                case 'eli5':
                    title = 'üë∂ Simple Explanation';
                    text = concept.eli5;
                    break;
                case 'technical':
                    title = 'üîß Technical Overview';
                    text = concept.technical;
                    break;
                case 'deep':
                    title = 'üî¨ Deep Technical Dive';
                    text = concept.deep;
                    break;
            }

            content.innerHTML = `
                <div class="level-content active">
                    <h4>${title}</h4>
                    <p>${text}</p>
                </div>
            `;
        }

        function renderFirstPrinciples(concept) {
            const list = document.getElementById('principlesList');
            list.innerHTML = concept.firstPrinciples.map(p => `
                <div class="principle-item" onclick="askPrinciple('${p}')">${p}</div>
            `).join('');
        }

        function askPrinciple(question) {
            document.getElementById('chatInput').value = question;
            sendChatMessage();
        }

        // ===== CHAT =====
        function handleChatKeypress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            const messages = document.getElementById('chatMessages');

            // Add user message
            messages.innerHTML += `
                <div class="chat-message user">
                    <div class="chat-avatar">You</div>
                    <div class="chat-bubble">${message}</div>
                </div>
            `;

            input.value = '';

            // Simulate AI response
            setTimeout(() => {
                const response = generateChatResponse(message);
                messages.innerHTML += `
                    <div class="chat-message">
                        <div class="chat-avatar">AI</div>
                        <div class="chat-bubble">${response}</div>
                    </div>
                `;
                messages.scrollTop = messages.scrollHeight;
            }, 1000);
        }

        function generateChatResponse(question) {
            const responses = {
                'floating point': "Floating point is how computers represent decimal numbers. Think of it like scientific notation (6.02 √ó 10¬≤¬≥). The computer stores a 'significand' (the 6.02 part) and an 'exponent' (the 23 part). Different formats like bf16 and fp32 trade off precision for memory‚Äîbf16 uses fewer bits, so it's faster but less precise.",
                'precision': "Precision refers to how many decimal places a number can accurately represent. bf16 can represent about 3-4 significant digits, while fp32 can do about 7-8. Usually this difference doesn't matter, but when comparing two very close numbers, the rounding can cause them to flip order.",
                'compiler': "A compiler translates code from one language to another‚Äîusually from human-readable code to machine instructions. XLA specifically compiles machine learning operations into optimized code for specific hardware. It makes smart decisions about how to execute operations efficiently.",
                'token': "In language models, a 'token' is a piece of text‚Äîcould be a word, part of a word, or punctuation. The model predicts the probability of each possible next token, then samples from the highest-probability ones. 'Top-k' means only considering the k most likely tokens.",
                'default': "That's a great question! This relates to how complex systems can have subtle interactions between components. The key insight is that what seems like a minor technical detail (like number precision) can cascade into user-visible bugs when systems operate at scale."
            };

            const q = question.toLowerCase();
            for (const [key, response] of Object.entries(responses)) {
                if (q.includes(key)) return response;
            }
            return responses.default;
        }

        // ===== TABS & STAGES =====
        function switchTab(tabId) {
            document.querySelectorAll('.content-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabId);
            });
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.toggle('active', panel.dataset.panel === tabId);
            });
        }

        function goToStage(stage) {
            currentStage = stage;

            // Update sidebar
            document.querySelectorAll('.stage-item').forEach(item => {
                const itemStage = parseInt(item.dataset.stage);
                item.classList.remove('active');
                if (itemStage < stage) {
                    item.classList.add('completed');
                } else if (itemStage === stage) {
                    item.classList.add('active');
                }
            });

            // Switch tab
            switchTab('stage' + stage);

            // Update retention based on stage
            const retentionMap = { 1: 10, 2: 30, 3: 50, 4: 90 };
            updateRetention(retentionMap[stage]);
        }

        function updateRetention(percent) {
            document.getElementById('retentionPercent').textContent = percent + '%';
            document.getElementById('retentionFill').style.width = percent + '%';
        }

        // ===== TYPING EFFECT =====
        function typeText(element, text, speed = 15) {
            element.innerHTML = '';
            let i = 0;
            const cursor = document.createElement('span');
            cursor.className = 'typing-cursor';

            function type() {
                if (i < text.length) {
                    element.textContent = text.substring(0, i + 1);
                    element.appendChild(cursor);
                    i++;
                    setTimeout(type, speed);
                } else {
                    cursor.remove();
                }
            }
            type();
        }

        // ===== CLOSE MODAL ON OUTSIDE CLICK =====
        document.getElementById('conceptModal').addEventListener('click', (e) => {
            if (e.target.id === 'conceptModal') {
                closeConceptModal();
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeConceptModal();
            }
        });

        // ===== INIT =====
        initTheme();
    </script>
</body>
</html>
